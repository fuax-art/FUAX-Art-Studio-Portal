<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUAX Metadata Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000;
            color: #00ffff;
        }
        #vanta-bg {
            position: fixed;
            inset: 0;
            z-index: -10;
            opacity: 0.3;
        }
        .container {
            background: rgba(0, 0, 0, 0.85);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #4c1800;
        }
        button {
            background: #4c1800;
            color: #00ffff;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #b34a20;
        }
        input, select {
            background: rgba(0, 0, 0, 0.7);
            color: #00ffff;
            border: 1px solid #4c1800;
            padding: 8px;
            border-radius: 4px;
        }
        textarea {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.9);
            color: #00ffff;
            border: 1px solid #4c1800;
            padding: 10px;
            font-family: monospace;
        }
        .trait-set {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            background: rgba(205, 92, 40, 0.3);
            border: 2px solid #4c1800;
            border-radius: 8px;
            cursor: pointer;
        }
        .trait-set.active {
            background: #4c1800;
            color: #000;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #00ffff;
        }
    </style>
</head>
<body>
    <div id="vanta-bg"></div>
    <script>
        VANTA.GLOBE({
            el: "#vanta-bg",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200,
            minWidth: 200,
            scale: 1.00,
            scaleMobile: 1.00,
            color: 0x00ffff,
            backgroundColor: 0x000000
        })
    </script>

    <div class="container">
        <div style="text-align:center; margin-bottom:1.5em;">
            <div style="font-size:1.8em; font-weight:bold; color:#00ffff; letter-spacing:2px;">Forever Unfinished Artworx <span style="font-size:0.9em; color:#4c1800;">(FUAX)</span></div>
            <div style="font-size:1.1em; color:#00cccc; margin-top:0.3em;">Metadata Generator</div>
        </div>

        <div class="controls">
            <div>
                <label>Number of Entries (1-100):</label>
                <input type="number" id="entryCount" min="1" max="100" value="50">
            </div>
            <div>
                <label>Custom Name Prefix (optional):</label>
                <input type="text" id="namePrefix" value="CyberPug">
            </div>
        </div>

        <div style="margin: 20px 0;">
            <h3 style="color:#00ffff;">Select Trait Set:</h3>
            <div class="trait-set active" onclick="selectTraitSet('cyber', this)">Cyber/Tech</div>
            <div class="trait-set" onclick="selectTraitSet('monster', this)">Monster</div>
            <div class="trait-set" onclick="selectTraitSet('human', this)">Human</div>
            <div class="trait-set" onclick="selectTraitSet('alien', this)">Alien</div>
        </div>

        <button onclick="generateMetadata()">üöÄ Generate Metadata</button>
        <button onclick="generateRandomNames()">üé≤ Generate Random Names</button>
        <button onclick="toggleTableView()">üìä Toggle Table View</button>
        <button onclick="clearOutput()">üóëÔ∏è Clear</button>
        <button onclick="downloadCSV()">üì• Download CSV</button>

        <div style="margin-top: 20px;">
            <h3 style="color:#00ffff;">Output:</h3>
            <textarea id="output" placeholder="Generated metadata will appear here..."></textarea>
        </div>
        <div id="tableView" style="display:none; margin-top:20px; overflow-x:auto;">
             <h3 style="color:#00ffff;">Table View:</h3>
             <table id="metadataTable" style="width:100%; border-collapse:collapse; background:rgba(0,0,0,0.7);">
             </table>
        </div>
    </div>

    <script>
        let currentTraitSet = 'cyber';
        let generatedData = [];

        const traitSets = {
            cyber: {
                personality: { 
                    "Hacker": 30, "Gamer": 17.9, "Coder": 10.7, "Rebel": 3, "Explorer": 2.1, 
                    "Glitcher": 8.9, "Architect": 7, "Phantom": 5.4, "Catalyst": 3, "Sentinel": 3,
                    "Guardian": 3, "Nomad": 3, "Oracle": 2, "Cipher": 1
                },
                affinity: { 
                    "Code Master": 25.0, "Data Analyst": 15.0, "Network Specialist": 12.0, "AI Whisperer": 10.0, 
                    "Quantum Hacker": 12.0, "Signal Jammer": 8.0, "Protocol Designer": 7.0, "Memory Trader": 4.0,
                    "Crypto Expert": 3.0, "Archivist": 2.5, "Synthesist": 1.5
                },
                energy: { 
                    "Focused": 28.0, "Hyper": 18.0, "Chill": 12.0, "Chaotic": 10.0, 
                    "Volatile": 12.0, "Overclocked": 10.0, "Dormant": 5.0,
                    "Zen": 3.0, "Static": 2.0
                },
                ability: { 
                    "Processing Power": 25.0, "Connection Speed": 18.0, "Firewall Strength": 12.0, 
                    "Ghost Protocol": 12.0, "System Overload": 12.0, "Backdoor Access": 8.0, "Neural Link": 6.0,
                    "Encryption Key": 3.5, "Data Surge": 2.0, "Mind Weave": 1.5
                },
                origin: { 
                    "Lab Creation": 24.0, "Street Upload": 18.0, "Corporate Escape": 15.0, 
                    "Deep Web Spawn": 15.0, "Glitch Accident": 10.0, "Rogue AI Fragment": 8.0,
                    "Open Source": 5.0, "Lost Code": 3.0, "Void-born": 2.0
                },
                utility: { "None": 90, "High-Res Access": 5.5, "Future Airdrop": 3.4, "Genesis": 1.1 }
            },
            monster: {
                personality: { 
                    "Fierce": 22.0, "Cunning": 18.0, "Wild": 15.0, "Ancient": 12.0, 
                    "Chaotic": 10.0, "Primal": 8.0, "Unpredictable": 6.0, "Ghostly": 4.0,
                    "Feral": 2.0, "Mythical": 2.0, "Primordial": 1.0
                },
                affinity: { 
                    "Shadow Walker": 24.0, "Night Hunter": 20.0, "Beast Master": 15.0, 
                    "Void Dweller": 12.0, "Soul Eater": 10.0, "Elemental": 8.0,
                    "Blood Sage": 5.0, "Chaos Whisperer": 3.0, "Nightmare Lord": 2.0, "Void King": 1.0
                },
                energy: { 
                    "Aggressive": 24.0, "Dormant": 20.0, "Explosive": 15.0, 
                    "Unstable": 12.0, "Corrupting": 10.0, "Demonic": 8.0,
                    "Vampiric": 5.0, "Spectral": 3.0, "Ethereal": 2.0, "Void Energy": 1.0
                },
                ability: { 
                    "Regeneration": 24.0, "Stealth": 20.0, "Strength": 15.0, 
                    "Terror Inducing": 12.0, "Teleportation": 10.0, "Shape Shifting": 8.0,
                    "Death Touch": 5.0, "Soul Drain": 3.0, "Time Stop": 2.0, "Reality Tear": 1.0
                },
                origin: { 
                    "Summoned": 22.0, "Mutated": 18.0, "Ancient Awakening": 15.0, 
                    "Dark Ritual": 12.0, "Chaotic Breach": 10.0, "Abyssal Plain": 8.0,
                    "Nightmare Realm": 6.0, "Void Depths": 4.0, "Elder Dimension": 3.0, "Primordial Chaos": 2.0
                },
                utility: { "None": 90.0, "High-Res Access": 5.5, "Future Airdrop": 3.4, "Genesis": 1.1 }
            },
            human: {
                personality: { 
                    "Leader": 22.0, "Strategist": 18.0, "Warrior": 15.0, "Scholar": 12.0, 
                    "Healer": 10.0, "Rogue": 8.0, "Innovator": 5.0, "Mystic": 4.0,
                    "Visionary": 3.0, "Sovereign": 2.0, "Prophet": 1.0
                },
                affinity: { 
                    "Combat Expert": 22.0, "Tactician": 18.0, "Diplomat": 15.0, 
                    "Engineer": 12.0, "Pilot": 10.0, "Survivalist": 8.0,
                    "Tech Savant": 6.0, "Quantum Sage": 4.0, "Time Weaver": 3.0, "Reality Shaper": 2.0
                },
                energy: { 
                    "Determined": 22.0, "Calm": 18.0, "Intense": 15.0, 
                    "Adaptive": 12.0, "Resilient": 10.0, "Focused": 8.0,
                    "Enlightened": 6.0, "Transcendent": 4.0, "Ascended": 3.0, "Divine": 2.0
                },
                ability: { 
                    "Leadership": 22.0, "Survival Instinct": 18.0, "Innovation": 15.0, 
                    "Persuasion": 12.0, "Psionic": 10.0, "Precognition": 8.0,
                    "Mind Control": 6.0, "Reality Shift": 4.0, "Time Manipulation": 3.0, "Creation": 2.0
                },
                origin: { 
                    "Urban": 22.0, "Military": 18.0, "Academic": 15.0, 
                    "Underground": 12.0, "Hidden City": 10.0, "Outpost": 8.0,
                    "Quantum Lab": 6.0, "Time Institute": 4.0, "Reality Corps": 3.0, "Infinity Guild": 2.0
                },
                utility: { "None": 90.0, "High-Res Access": 5.5, "Future Airdrop": 3.4, "Genesis": 1.1 }
            },
            alien: {
                personality: { 
                    "Observer": 22.0, "Collector": 18.0, "Emissary": 15.0, "Traveler": 12.0, 
                    "Ancient": 10.0, "Architect": 8.0, "Watcher": 6.0, "Transcendent": 4.0,
                    "Eternal": 2.0, "Celestial": 2.0, "Universal": 1.0
                },
                affinity: { 
                    "Telepathic": 22.0, "Quantum Mind": 18.0, "Hive Linked": 15.0, 
                    "Cosmic Aware": 12.0, "Time Bending": 10.0, "Dimension Walker": 8.0,
                    "Star Weaver": 6.0, "Reality Dancer": 4.0, "Void Speaker": 3.0, "Universe Shaper": 2.0
                },
                energy: { 
                    "Ethereal": 22.0, "Pulsing": 18.0, "Transdimensional": 15.0, 
                    "Crystalline": 12.0, "Singularity": 10.0, "Cosmic Ray": 8.0,
                    "Star Force": 6.0, "Dark Matter": 4.0, "Quantum Flux": 3.0, "Universal Force": 2.0
                },
                ability: { 
                    "Telekinesis": 22.0, "Phase Shift": 18.0, "Mind Link": 15.0, 
                    "Reality Bend": 12.0, "Matter Manipulation": 10.0, "Soul Absorb": 8.0,
                    "Star Control": 6.0, "Time Mastery": 4.0, "Dimension Craft": 3.0, "Creation Force": 2.0
                },
                origin: { 
                    "Distant Star": 22.0, "Wormhole": 18.0, "Dimensional Rift": 15.0, 
                    "Ancient Colony": 12.0, "Galactic Core": 10.0, "Void of Creation": 8.0,
                    "Quantum Nexus": 6.0, "Star Forge": 4.0, "Cosmic Veil": 3.0, "Universal Core": 2.0
                },
                utility: { "None": 90.0, "High-Res Access": 5.5, "Future Airdrop": 3.4, "Genesis": 1.1 }
            human: {
                personality: { 
                    "Leader": 24.0, "Strategist": 20.0, "Warrior": 18.0, "Scholar": 15.0, 
                    "Healer": 10.0, "Rogue": 8.0, "Innovator": 5.0
                },
                affinity: { 
                    "Combat Expert": 25.0, "Tactician": 22.0, "Diplomat": 18.0, 
                    "Engineer": 15.0, "Pilot": 12.0, "Survivalist": 8.0
                },
                energy: { 
                    "Determined": 25.0, "Calm": 22.0, "Intense": 20.0, 
                    "Adaptive": 18.0, "Resilient": 15.0
                },
                ability: { 
                    "Leadership": 24.0, "Survival Instinct": 22.0, "Innovation": 20.0, 
                    "Persuasion": 15.0, "Psionic": 12.0, "Precognition": 7.0
                },
                origin: { 
                    "Urban": 24.0, "Military": 22.0, "Academic": 18.0, 
                    "Underground": 15.0, "Hidden City": 12.0, "Outpost": 9.0
                },
                utility: { "None": 90.0, "High-Res Access": 5.5, "Future Airdrop": 3.4, "Genesis": 1.1 }
            },
            alien: {
                personality: { 
                    "Observer": 24.0, "Collector": 20.0, "Emissary": 18.0, "Traveler": 15.0, 
                    "Ancient": 12.0, "Architect": 8.0, "Watcher": 3.0
                },
                affinity: { 
                    "Telepathic": 25.0, "Quantum Mind": 22.0, "Hive Linked": 18.0, 
                    "Cosmic Aware": 15.0, "Time Bending": 12.0, "Dimension Walker": 8.0
                },
                energy: { 
                    "Ethereal": 24.0, "Pulsing": 22.0, "Transdimensional": 20.0, 
                    "Crystalline": 15.0, "Singularity": 12.0, "Cosmic Ray": 7.0
                },
                ability: { 
                    "Telekinesis": 24.0, "Phase Shift": 22.0, "Mind Link": 18.0, 
                    "Reality Bend": 15.0, "Matter Manipulation": 12.0, "Soul Absorb": 9.0
                },
                origin: { 
                    "Distant Star": 24.0, "Wormhole": 22.0, "Dimensional Rift": 18.0, 
                    "Ancient Colony": 15.0, "Galactic Core": 12.0, "Void of Creation": 9.0
                },
                utility: { "None": 90.0, "High-Res Access": 5.5, "Future Airdrop": 3.4, "Genesis": 1.1 }
            }
        };

        function selectTraitSet(set, element) {
            currentTraitSet = set;
            document.querySelectorAll('.trait-set').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
        }

        function generateRandomName() {
            const namePatterns = {
                cyber: {
                    prefixes: ["Chrono", "Pixel", "Core", "Wave", "Pulse", "Node", "Shift", "Spark", "Blast","Synth", "Zone", "Circuit", "Echo", "Cyber", "Neo", "Quantum", "Digital", "Plasma", "Neon", "Glitch", "Flux", "Binary", "Data"],
                    suffixes: ["Byte", "Chip", "Hack", "Net", "Code", "Bot", "Drone", "Grid", "Link", "Node",  "Tech", "Wave", "Core", "Pulse", "Flux", "Spark", "Shift", "Glitch", "Pixel"]
                },
                monster: {
                    prefixes: ["Fang", "Claw", "Maw", "Terror", "Bane", "Reaver", "Stalker", "Hunter", "Shadow", "Dark", "Blood", "Fang", "Claw", "Void", "Doom", "Rage", "Beast", "Primal"],
                    suffixes: ["Howl", "Snarl", "Lord", "Fiend", "Bringer", "Stalker", "Hunter", "Wraith", "Terror", "Giant", "Crusher", "Howler"]
                },
                human: {
                    prefixes: ["Strike", "Fist", "Edge", "Born", "Heart", "Soul", "Eye", "Hand", "Walker", "Runner", "Blade", "Ghost", "Viper", "Raven", "Wolf", "Hawk", "Rogue"],
                    suffixes: ["Fury", "Strike", "Shadow", "Rider", "Hunter", "Warrior", "Guardian", "Seeker", "Nomad", "Storm", "Steel", "Iron", "Thunder"]
                },
                alien: {
                    prefixes: ["Xeno", "Zeta", "Kryo", "Vex", "Nex", "Quar", "Tari", "Luma", "Orin", "Vira", "Xylo", "Zyra", "Kora", "Mira", "Nova", "Prax", "Ryn", "Sora", "Talon", "Vara", "Xeno", "Cosmic", "Void", "Star", "Nova", "Quantum", "Phase", "Warp", "Nebula", "Astral"],
                    suffixes: ["ling", "oid", "ite", "ar", "on", "arion", "ax", "ex", "us", "ar", "Form", "Entity", "Being", "Essence", "Mind", "Consciousness", "Traveler", "Observer", "Seeker", "Keeper"]
                }
            };
            
            const patterns = namePatterns[currentTraitSet];
            return patterns.prefixes[Math.floor(Math.random() * patterns.prefixes.length)] + 
                   patterns.suffixes[Math.floor(Math.random() * patterns.suffixes.length)];
        }

        function generateRandomNames() {
            const count = parseInt(document.getElementById('entryCount').value) || 9;
            let names = '';
            for (let i = 0; i < count; i++) {
                names += generateRandomName() + (i < count - 1 ? ', ' : '');
            }
            alert(`Random names generated:\n\n${names}\n\nCopy these to use as custom names!`);
        }

        function toggleTableView() {
            const table = document.getElementById('tableView');
            table.style.display = table.style.display === 'none' ? 'block' : 'none';
        }

        function randomPickWeighted(weights) {
            let sum = 0;
            for (let trait in weights) {
                sum += weights[trait];
            }
            let rand = Math.floor(Math.random() * sum);
            let cumulative = 0;
            for (let trait in weights) {
                cumulative += weights[trait];
                if (rand < cumulative) {
                    return trait;
                }
            }
        }

        function generateMetadata() {
            const count = parseInt(document.getElementById('entryCount').value) || 100;
            const namePrefix = document.getElementById('namePrefix').value || "FUAX";
            const traits = traitSets[currentTraitSet];
            generatedData = [];
            
            // Determine the number of NFTs you want to be "common"
            const numToForceCommon = Math.floor(count * 0.2); // 20% of the collection will be common
            
            // Force common NFTs
            for (let i = 1; i <= numToForceCommon; i++) {
                generatedData.push({
                    id: i,
                    name: `${namePrefix} #${i.toString().padStart(3, '0')}`,
                    description: `A unique ${currentTraitSet} entity from the Forever Unfinished Artworx collection`,
                    personality: Object.keys(traits.personality)[0],
                    affinity: Object.keys(traits.affinity)[0],
                    energy: Object.keys(traits.energy)[0],
                    ability: Object.keys(traits.ability)[0],
                    origin: Object.keys(traits.origin)[0],
                    utility: Object.keys(traits.utility)[0],
                    forcedTier: "Common"
                });
            }

            // Generate the rest of the collection randomly
            for (let i = numToForceCommon + 1; i <= count; i++) {
                generatedData.push({
                    id: i,
                    name: `${namePrefix} #${i.toString().padStart(3, '0')}`,
                    description: `A unique ${currentTraitSet} entity from the Forever Unfinished Artworx collection`,
                    personality: randomPickWeighted(traits.personality),
                    affinity: randomPickWeighted(traits.affinity),
                    energy: randomPickWeighted(traits.energy),
                    ability: randomPickWeighted(traits.ability),
                    origin: randomPickWeighted(traits.origin),
                    utility: randomPickWeighted(traits.utility),
                });
            }

            // Shuffle the array to randomize the order
            generatedData.sort(() => Math.random() - 0.5);

            updateOutput();
        }

        function updateOutput() {
            const traits = traitSets[currentTraitSet];
            const totalNFTs = generatedData.length;
            
            // Calculate trait frequencies
            const traitFrequencies = {};
            Object.keys(traits).forEach(category => {
                traitFrequencies[category] = {};
                generatedData.forEach(item => {
                    const value = item[category];
                    traitFrequencies[category][value] = (traitFrequencies[category][value] || 0) + 1;
                });
            });
            
            // Calculate and assign rarity for each NFT
            generatedData.forEach(item => {
                // If this NFT has a forced tier (commons), skip calculation and use the forced tier
                if (item.forcedTier) {
                    item.rarityTier = item.forcedTier;
                    item.rarityScore = "1.00";
                    item.traitRarities = {};
                    
                    // Still calculate trait rarities for display purposes
                    Object.keys(traits).forEach(category => {
                        const value = item[category];
                        const frequency = traitFrequencies[category][value];
                        const rarityPercent = (frequency / totalNFTs);
                        
                        item.traitRarities[category] = {
                            value: value,
                            frequency: frequency,
                            percentage: (rarityPercent * 100).toFixed(1)
                        };
                    });
                    return; // Skip normal rarity calculation
                }
                
                // Normal rarity calculation for non-forced NFTs
                let rarityScore = 1;
                item.traitRarities = {};
                
                Object.keys(traits).forEach(category => {
                    const value = item[category];
                    const frequency = traitFrequencies[category][value];
                    const rarityPercent = (frequency / totalNFTs);
                    
                    item.traitRarities[category] = {
                        value: value,
                        frequency: frequency,
                        percentage: (rarityPercent * 100).toFixed(1)
                    };
                    
                    rarityScore *= (1 / rarityPercent);
                });
                
                item.rarityScore = rarityScore.toFixed(2);
                
                // Assign tier based on score distribution
                if (item.rarityScore >= 300000) item.rarityTier = "Legendary";
                else if (item.rarityScore >=9000) item.rarityTier = "Epic";
                else if (item.rarityScore >= 1000) item.rarityTier = "Rare";
                else if (item.rarityScore >= 100) item.rarityTier = "Uncommon";
                else item.rarityTier = "Common";
            });
            
            // Now assign utility to half of the legendaries
            const legendaries = generatedData.filter(item => item.rarityTier === "Legendary" && !item.forcedTier);
            const numLegendariesWithUtility = Math.floor(legendaries.length / 2);
            
            // Shuffle legendaries and assign utility to first half
            legendaries.sort(() => Math.random() - 0.5);
            
            const utilityOptions = Object.keys(traits.utility).filter(u => u !== "None");
            for (let i = 0; i < numLegendariesWithUtility; i++) {
                const randomUtility = utilityOptions[Math.floor(Math.random() * utilityOptions.length)];
                legendaries[i].utility = randomUtility;
            }
            
            // Sort by rarity score (highest first) for better display
            generatedData.sort((a, b) => b.rarityScore - a.rarityScore);

            // The rest of your code for output and table view can stay the same
            let csv = "ID,Name,Description,Personality,Affinity,Energy,Ability,Origin,Utility,Rarity Score,Rarity Tier\n";
            generatedData.forEach(item => {
                csv += `${item.id},"${item.name}","${item.description}","${item.personality}","${item.affinity}","${item.energy}","${item.ability}","${item.origin}","${item.utility}",${item.rarityScore},${item.rarityTier}\n`;
            });
            
            csv += "\n\n=== TRAIT RARITY BREAKDOWN ===\n";
            csv += "NFT ID,Trait Type,Trait Value,Appears In Collection,Rarity %\n";
            generatedData.forEach(item => {
                Object.keys(item.traitRarities).forEach(category => {
                    const trait = item.traitRarities[category];
                    csv += `${item.id},${category},${trait.value},${trait.frequency}/${totalNFTs},${trait.percentage}%\n`;
                });
            });
            
            document.getElementById('output').value = csv;
            
            const table = document.getElementById('metadataTable');
            table.innerHTML = `
                <thead>
                    <tr style="background:#4c1800; color:#000;">
                        <th style="padding:10px; border:1px solid #4c1800;">ID</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Name</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Personality</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Affinity</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Energy</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Ability</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Origin</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Utility</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Rarity</th>
                        <th style="padding:10px; border:1px solid #4c1800;">Tier</th>
                    </tr>
                </thead>
                <tbody>
                    ${generatedData.map(item => {
                        const tierColor = 
                            item.rarityTier === "Legendary" ? "#FFD700" :
                            item.rarityTier === "Epic" ? "#9D4EDD" :
                            item.rarityTier === "Rare" ? "#3A86FF" :
                            item.rarityTier === "Uncommon" ? "#06D6A0" : "#00ffff";
                        
                        return `
                        <tr style="color:#00ffff;">
                            <td style="padding:8px; border:1px solid #4c1800;">${item.id}</td>
                            <td style="padding:8px; border:1px solid #4c1800;">${item.name}</td>
                            <td style="padding:8px; border:1px solid #4c1800;">${item.personality}</td>
                            <td style="padding:8px; border:1px solid #4c1800;">${item.affinity}</td>
                            <td style="padding:8px; border:1px solid #4c1800;">${item.energy}</td>
                            <td style="padding:8px; border:1px solid #4c1800;">${item.ability}</td>
                            <td style="padding:8px; border:1px solid #4c1800;">${item.origin}</td>
                            <td style="padding:8px; border:1px solid #4c1800;">${item.utility}</td>
                            <td style="padding:8px; border:1px solid #4c1800; font-weight:bold;">${item.rarityScore}</td>
                            <td style="padding:8px; border:1px solid #4c1800; font-weight:bold; color:${tierColor};">${item.rarityTier}</td>
                        </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
            `;
            
            document.getElementById('tableView').style.display = 'block';
        }

        function downloadCSV() {
            if (generatedData.length === 0) {
                alert('Generate metadata first before downloading!');
                return;
            }
            
            const csvContent = document.getElementById('output').value;
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const timestamp = new Date().toISOString().slice(0,10);
            const filename = `FUAX_metadata_${currentTraitSet}_${timestamp}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearOutput() {
            document.getElementById('output').value = '';
            document.getElementById('tableView').style.display = 'none';
            generatedData = [];
        }
    </script>
</body>
</html>
